(()=>{var e={};e.id=892,e.ids=[892],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},209:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5315:e=>{"use strict";e.exports=require("path")},7360:e=>{"use strict";e.exports=require("url")},6718:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d});var r=s(9442),a=s(42),l=s(8190),i=s.n(l),n=s(3289),o={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);s.d(t,o);let d=["",{children:["postsample",{children:["[postId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,9031)),"/Users/jiumi/Documents/project/travel web/f/src/app/postsample/[postId]/page.js"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,3881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,934)),"/Users/jiumi/Documents/project/travel web/f/src/app/layout.js"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,6042,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,3881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/Users/jiumi/Documents/project/travel web/f/src/app/postsample/[postId]/page.js"],m={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/postsample/[postId]/page",pathname:"/postsample/[postId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8343:(e,t,s)=>{Promise.resolve().then(s.bind(s,9031))},9510:(e,t,s)=>{Promise.resolve().then(s.bind(s,8840))},252:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});var r=s(6493);s(3606),s(5582);let a=()=>(0,r.jsxs)("div",{className:"loading-container",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{className:"loading-text",children:"加载中，请稍候..."})]})},226:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var r=s(6493),a=s(3606),l=s(7573);let i=({postId:e,initialLikes:t,initialCollections:s,initialIsLiked:i,initialIsCollected:n,initialViews:o})=>{let[d,c]=(0,a.useState)(t),[m,p]=(0,a.useState)(s),[u,h]=(0,a.useState)(i),[x,g]=(0,a.useState)(n),[b,f]=(0,a.useState)(o),[A,j]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{let t=await (0,l.U2)(`/posts/${e}/actions`,{},!0);c(t.likes),p(t.collections),h(t.isLiked),g(t.isCollected),f(t.views)}catch(e){y("Error fetching post actions: "+e.message)}})()},[e]);let w=async()=>{if(!localStorage.getItem("token")){alert("Please login first");return}if(!A){j(!0),y(null),c(u?d-1:d+1),h(!u);try{let t=await (0,l.v_)(`/posts/${e}/like`,{method:"POST"});if(200!==t.status)throw Error("Network response was not ok");let s=await t;c(s.likes),h(s.hasLiked)}catch(e){y("Error liking post: "+e.message),c(u?d+1:d-1),h(e=>!e)}finally{j(!1)}}},N=async()=>{if(!localStorage.getItem("token")){alert("Please login first");return}if(!A){j(!0),y(null),p(x?m-1:m+1),g(e=>!e);try{let t=await (0,l.v_)(`/posts/${e}/collect`,{},!0);if(200!==t.status)throw Error("Network response was not ok");p(t.collections),g(t.isCollected)}catch(e){y("Error collecting post: "+e.message),p(x?m+1:m-1),g(!x)}finally{j(!1)}}};return(0,r.jsxs)("div",{className:"flex space-x-4 mt-2 bg-transparent",children:[v&&(0,r.jsx)("div",{className:"text-red-500",children:v}),(0,r.jsxs)("button",{onClick:w,disabled:A,"aria-label":u?"Unlike post":"Like post",className:`flex items-center space-x-1 px-4 py-2 rounded-lg transition duration-200 ease-in-out ${u?"text-red-500 bg-gray-200 hover:bg-gray-300":"text-gray-500 bg-gray-200 hover:bg-gray-300"}`,children:[(0,r.jsx)("span",{children:u?"❤️":"\uD83E\uDD0D"}),(0,r.jsx)("span",{children:d})]}),(0,r.jsxs)("button",{onClick:N,disabled:A,"aria-label":x?"Uncollect post":"Collect post",className:`flex items-center space-x-1 px-4 py-2 rounded-lg transition duration-200 ease-in-out ${x?"text-yellow-500 bg-gray-200 hover:bg-gray-300":"text-gray-500 bg-gray-200 hover:bg-gray-300"}`,children:[(0,r.jsx)("span",{children:x?"⭐":"☆"}),(0,r.jsx)("span",{children:m})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-1 px-4 py-2 rounded-lg transition duration-200 ease-in-out bg-gray-200 text-gray-800 hover:bg-gray-300",children:[(0,r.jsx)("span",{children:"\uD83D\uDC41️"}),(0,r.jsx)("span",{children:b})]})]})}},8840:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var r=s(6493),a=s(3606),l=s(4619),i=s(7573),n=s(5723),o=s(4971);s(5735);var d=s(252);let c={src:"/_next/static/media/del.982d3c5e.png",height:120,width:120,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAJFBMVEX///////////////////9MaXH///////////////////////9BjiGlAAAADHRSTlNsCitjhgBFcxg7lqTdtZYcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAN0lEQVR4nBXGQRIAIAgDsaUFFP3/fx1PCRF5TkYwN9fKO2yie3/YWAS1ZA9FIbt/PFK7KCWk6gEo8wEG06L3SQAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},m={src:"/_next/static/media/edit.391ed3cc.png",height:120,width:120,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAJ1BMVEVMaXH////////////////////////////////////////////////c+C/6AAAADHRSTlMAIIZboD/faQlKMMSid8+rAAAACXBIWXMAAAsTAAALEwEAmpwYAAAANklEQVR4nCXKWw7AMAwCwU2x4zx8//NWtHwwEgKAHG7YEcuqZ3hS97Qj7ALd+q87pFId8vmSLxrbANZGrlDhAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8};var p=s(226);let u=()=>{let{postId:e}=(0,l.useParams)(),[t,s]=(0,a.useState)(null),[u,h]=(0,a.useState)([]),[x,g]=(0,a.useState)(""),[b,f]=(0,a.useState)(null),[A,j]=(0,a.useState)(!1),[v,y]=(0,a.useState)([]),[w,N]=(0,a.useState)([]),[k,_]=(0,a.useState)(null),[C,S]=(0,a.useState)(!1),[D,E]=(0,a.useState)(1),[$,P]=(0,a.useState)(0),[I,U]=(0,a.useState)(1),[L,M]=(0,a.useState)("");(0,a.useEffect)(()=>{let t=async()=>{try{let t=await (0,i.U2)(`/posts/${e}/getPostData`,{},!0);S(t.permission),s(t.post);let r=await (0,i.U2)(`/posts/${e}/comments/${D}/5`,!1);h(r.comments),U(r.totalPages);let a=await (0,i.U2)(`/posts/recommendations/${e}`,!1);y(a.recommendations),F(t.post.content)}catch(e){f("Failed to load post and comments"),console.error(e)}};e&&t()},[e]),(0,a.useEffect)(()=>{(async()=>{let t=await (0,i.U2)(`/posts/${e}/comments/${D}/5`,!1);h(t.comments),U(t.totalPages)})()},[D,$]);let F=e=>{if(!e)return;let t=new DOMParser().parseFromString(e,"text/html");N(Array.from(t.querySelectorAll("h1, h2, h3")).map((e,t)=>{let s=`heading-${t}`;return e.setAttribute("id",s),{text:e.innerText,id:s,level:e.tagName}})),s(e=>({...e,content:t.body.innerHTML}))},R=async t=>{if(t.preventDefault(),x.trim()){j(!0),f(null);try{let t=await (0,i.v_)(`/posts/${e}/comments`,{content:x.trim()},!0);h(e=>[t,...e]),g(""),P($+1)}catch(e){f(e.message),console.error("Comment submission error:",e)}finally{j(!1)}}},q=async t=>{if(null==localStorage.getItem("token")){alert("請先登入");return}try{let s=await (0,i.v_)(`/posts/${e}/comments/${t}/like`,{},!1);G(s)}catch(e){console.error("Like error:",e),f("Failed to like comment")}},B=async t=>{if(null==localStorage.getItem("token")){alert("請先登入");return}try{let s=await (0,i.v_)(`/posts/${e}/comments/${t}/dislike`,{},!1);G(s)}catch(e){console.error("Dislike error:",e),f("Failed to dislike comment")}},G=e=>{h(t=>t.map(t=>t._id===e._id?{...t,likes:e.likes,dislikes:e.dislikes,hasLiked:e.hasLiked,hasDisliked:e.hasDisliked}:t))},T=async()=>{if(window.confirm("您确定要删除这篇文章吗？"))try{await (0,i.v_)(`/posts/${e}/delete`,{},!0),window.location.href="/"}catch(e){console.error("Delete post error:",e),f("Failed to delete post")}},H=async t=>{if(null==localStorage.getItem("token")){alert("請先登入");return}if(window.confirm("您确定要删除这条评论吗？"))try{await (0,i.v_)(`/posts/${e}/comments/${t}/delete`,{},!0),h(e=>e.filter(e=>e._id!==t)),P($+1)}catch(e){console.error("Delete comment error:",e),f("Failed to delete comment")}},X=e=>{let t=document.getElementById(e);t&&(t.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{_(e)},500))};return((0,a.useEffect)(()=>{let e=()=>{let e=w.map(e=>document.getElementById(e.id));window.scrollY;let t=null;e.forEach(e=>{let{top:s}=e.getBoundingClientRect();s>=0&&s<=window.innerHeight&&(t=e.id)}),t&&_(t)};return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}},[w]),t)?(0,r.jsx)("div",{className:"container mx-auto p-5",style:{maxWidth:"60%"},children:(0,r.jsxs)("div",{className:"main-content flex flex-col",children:[(0,r.jsxs)("div",{className:"post-content mb-10",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:t.title}),t.img_path&&(0,r.jsx)("div",{className:"image-container flex justify-center my-5",children:(0,r.jsx)("img",{src:t.img_path,alt:t.title||"Post image",className:"post-image max-w-full rounded-lg"})}),(0,r.jsx)("div",{className:"ql-editor",dangerouslySetInnerHTML:{__html:t.content}}),(0,r.jsxs)("p",{className:"post-date text-gray-500",children:["Posted on: ",new Date(t.Creation_time).toLocaleString()]}),(0,r.jsxs)("div",{className:"author-info font-semibold",children:[(0,r.jsx)("strong",{children:"发帖人:"})," ",t.user_id.username]}),C&&(0,r.jsxs)("div",{children:[(0,r.jsx)(n.default,{href:`/post/edit/${t._id}`,children:(0,r.jsx)("button",{className:"edit-button bg-blue-500 text-white rounded px-2 py-1 ml-2 hover:bg-blue-600 ",children:(0,r.jsx)(o.default,{src:m,alt:"edit",width:20,height:20})})}),(0,r.jsx)("button",{className:"delete-button bg-red-500 text-white rounded px-2 py-1 ml-2 hover:bg-red-600",onClick:()=>T(t._id),children:(0,r.jsx)(o.default,{src:c,alt:"delete",width:20,height:20})})]})]}),(0,r.jsxs)("div",{className:"comment-section",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold",children:"留言"}),(0,r.jsxs)("div",{className:"comment-input-container mb-5",children:[(0,r.jsx)("textarea",{className:"comment-input w-full p-3 border border-gray-300 rounded",placeholder:"在此輸入您的評論...",value:x,onChange:e=>g(e.target.value)}),(0,r.jsx)("button",{className:"comment-button bg-green-500 text-white rounded px-4 py-2 mt-2 hover:bg-green-600 disabled:bg-gray-300",onClick:R,disabled:A,children:A?"發表中...":"發表"})]}),(0,r.jsx)("div",{className:"comments-list space-y-6",children:u.map(e=>(0,r.jsxs)("div",{className:"comment flex border-b border-gray-200 py-4 items-start",children:[(0,r.jsx)(n.default,{href:`/user/${e.user._id}/`,children:(0,r.jsx)(o.default,{src:e.user.img_path,alt:`${e.user.username} avatar`,width:50,height:50,className:"rounded-full w-12 h-12 mr-4"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("h4",{className:"font-semibold text-lg flex items-center",children:[e.user.name,e.user._id===t.user_id._id&&(0,r.jsx)("span",{className:"post-owner-label text-green-600 ml-2 text-sm",children:" (楼主)"})]}),(0,r.jsx)("p",{className:"mt-1 text-gray-800",children:e.content}),(0,r.jsxs)("p",{className:"comment-date text-gray-500 text-sm mt-1",children:["在"," ",new Date(e.Creation_time).toLocaleString("zh-CN",{hour12:!0,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/\//g,"-")," ","发布评论"]}),(0,r.jsxs)("div",{className:"comment-footer flex space-x-4 mt-3",children:[(0,r.jsxs)("button",{className:`like-button flex items-center border rounded px-3 py-1 transition ${e.hasLiked?"bg-blue-200 border-blue-400":"bg-transparent border-gray-300 hover:bg-gray-100"}`,onClick:()=>q(e._id),children:["\uD83D\uDC4D ",e.likes||0]}),(0,r.jsxs)("button",{className:`dislike-button flex items-center border rounded px-3 py-1 transition ${e.hasDisliked?"bg-red-200 border-red-400":"bg-transparent border-gray-300 hover:bg-gray-100"}`,onClick:()=>B(e._id),children:["\uD83D\uDC4E ",e.dislikes||0]}),e.permission&&(0,r.jsx)("button",{className:"delete-button bg-red-500 text-white rounded px-2 py-1 ml-2 hover:bg-red-600 flex items-center",onClick:()=>H(e._id),children:(0,r.jsx)(o.default,{src:c,alt:"delete",width:20,height:20})})]})]})]},e._id))}),I>1&&(0,r.jsxs)("div",{className:"pagination flex justify-center space-x-4 mt-6",children:[(0,r.jsx)("button",{onClick:()=>{D>1&&E(e=>e-1)},className:`px-4 py-2 border rounded ${1===D?"opacity-50 cursor-not-allowed":"bg-gray-100 hover:bg-gray-200"} `,disabled:1===D,children:"上一页"}),(0,r.jsxs)("span",{className:"flex items-center",children:["Page ",D," of ",I]}),(0,r.jsx)("button",{onClick:()=>{D<I&&E(e=>e+1)},className:`px-4 py-2 border rounded ${D===I?"opacity-50 cursor-not-allowed":"bg-gray-100 hover:bg-gray-200"} `,disabled:D===I,children:"下一页"}),(0,r.jsxs)("div",{className:"flex items-center ml-4",children:[(0,r.jsx)("input",{type:"text",value:L,onChange:e=>{M(e.target.value.replace(/\D/,""))},className:"w-16 text-center border rounded px-2 py-1",placeholder:"Page"}),(0,r.jsx)("button",{onClick:()=>{let e=parseInt(L,10);e>=1&&e<=I&&E(e),M("")},className:"ml-2 bg-blue-500 text-white rounded px-3 py-1 hover:bg-blue-600",children:"跳转"})]})]}),(0,r.jsxs)("div",{className:"recommendations-section mt-10",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold",children:"相关推荐"}),(0,r.jsx)("div",{className:"recommendations-list flex flex-wrap gap-5",children:v.length>0?v.map(e=>(0,r.jsx)("div",{className:"recommendation flex flex-col items-center",children:(0,r.jsx)("a",{href:`/postsample/${e._id}`,className:"recommendation-link",children:(0,r.jsxs)("div",{className:"recommendation-content flex",children:[(0,r.jsx)("img",{src:e.img_path,alt:e.title,className:"rec-image w-48 rounded"}),(0,r.jsxs)("div",{className:"rec-text flex-1 ml-4",children:[(0,r.jsx)("h4",{className:"font-semibold",children:e.title}),(0,r.jsxs)("p",{children:["相似度: ",e.similarity.toFixed(2)]})]})]})})},e._id)):(0,r.jsx)("p",{children:"没有找到相关推荐"})})]})]}),(0,r.jsxs)("div",{className:" fixed right-20 top-24 h-auto bg-transparent p-3",children:[(0,r.jsx)(p.Z,{postId:t._id}),w.length>0&&(0,r.jsxs)("div",{className:"toc fixed right-20 top-44 w-64 max-h-96 overflow-y-auto p-3 border border-gray-300 rounded bg-white shadow-lg",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold",children:"目录"}),(0,r.jsx)("ul",{children:w.map(e=>(0,r.jsxs)("li",{className:`toc-item flex items-center ${k===e.id?"font-bold":""} mb-2`,children:[k===e.id&&(0,r.jsx)("span",{className:"indicator text-blue-400 mr-2",children:"•"}),(0,r.jsx)("button",{className:`toc-link toc-${e.level.toLowerCase()} ${k===e.id?"text-blue-600":"text-black"} text-left w-full py-2`,onClick:()=>X(e.id),children:e.text})]},e.id))})]})]})]})}):(0,r.jsx)(d.Z,{})}},9031:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8105).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/jiumi/Documents/project/travel web/f/src/app/postsample/[postId]/page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/jiumi/Documents/project/travel web/f/src/app/postsample/[postId]/page.js","default")},3881:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(5394);let a=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]},5582:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[492,870,394,137],()=>s(6718));module.exports=r})();