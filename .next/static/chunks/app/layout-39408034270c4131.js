(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{6766:(e,t,a)=>{Promise.resolve().then(a.bind(a,3278))},3278:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var r=a(7437),s=a(9965),l=a.n(s),o=a(900),n=a.n(o),i=a(2265),d=a(3390);let c={modalOverlay:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3},modalContent:{background:"white",padding:"40px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)",width:"350px",textAlign:"center"},input:{width:"100%",padding:"12px",margin:"10px 0",border:"1px solid #ccc",borderRadius:"5px",transition:"border-color 0.3s, box-shadow 0.3s",boxSizing:"border-box",outline:"none"},button:{padding:"12px 20px",width:"100%",background:"#6e8efb",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",transition:"background 0.3s, transform 0.3s",margin:"10px 0",fontWeight:"bold"}},u=e=>{let{onClose:t,onLoginSuccess:a}=e,[s,l]=(0,i.useState)(""),[o,n]=(0,i.useState)("");async function u(e){if(e.preventDefault(),s&&o){let e=await (0,d.v_)("/users/check-login",{usernameOrEmail:s,password:o},!1);console.log("Response from server:",e),200===e.status?(console.log(e),localStorage.setItem("token",e.token),localStorage.setItem("userId",e.data._id),window.location.reload(),a(e.data)):(e.status,alert(e.message))}else alert("用户名或密码不能为空。")}return(0,r.jsx)("div",{className:"modalOverlay",style:c.modalOverlay,onClick:t,children:(0,r.jsxs)("div",{className:"modalContent",style:c.modalContent,onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("h2",{children:"登入"}),(0,r.jsxs)("form",{onSubmit:u,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"usernameOrEmail",children:"帳戶/電子郵件"}),(0,r.jsx)("input",{type:"text",id:"usernameOrEmail",value:s,onChange:e=>l(e.target.value),required:!0,style:c.input})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",children:"密碼"}),(0,r.jsx)("input",{type:"password",id:"password",value:o,onChange:e=>n(e.target.value),required:!0,style:c.input})]}),(0,r.jsx)("button",{type:"submit",style:c.button,children:"登入"})]})]})})},A={modalOverlay:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1e3},modalContent:{background:"white",padding:"40px",borderRadius:"10px",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.1)",width:"400px",color:"black",textAlign:"center"},input:{width:"100%",padding:"12px",margin:"10px 0",border:"1px solid #ddd",borderRadius:"5px",transition:"border-color 0.3s, box-shadow 0.3s",boxSizing:"border-box",outline:"none",color:"#333"},button:{padding:"12px 20px",width:"100%",background:"#6e8efb",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",transition:"background 0.3s, transform 0.3s",margin:"10px 0",fontWeight:"bold"}},h=e=>{let{onClose:t,onLoginSuccess:a}=e,[s,l]=(0,i.useState)(""),[o,n]=(0,i.useState)(""),[c,u]=(0,i.useState)(""),[h,g]=(0,i.useState)(""),[m,x]=(0,i.useState)(""),[p,b]=(0,i.useState)(""),w=async e=>{if(e.preventDefault(),h!==m){b("密码和确认密码不匹配");return}try{let e=await (0,d.v_)("/users/Create-user",{name:s,username:o,email:c,password:h},!1);200===e.status?(console.log("注册成功"),localStorage.setItem("token",e.token),localStorage.setItem("userId",e.data._id),a({username:e.data.username,email:e.data.email}),t()):(console.log("注册失败:",e.message),b(e.message))}catch(e){console.error(e),b("发生错误，请稍后再试。")}};return(0,r.jsx)("div",{className:"modalOverlay",style:A.modalOverlay,onClick:t,children:(0,r.jsxs)("div",{className:"modalContent",style:A.modalContent,onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("h2",{children:"注册"}),p&&(0,r.jsx)("p",{style:{color:"red"},children:p})," ",(0,r.jsxs)("form",{onSubmit:w,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"accountName",children:"账户名称"}),(0,r.jsx)("input",{type:"text",id:"accountName",value:o,onChange:e=>n(e.target.value),required:!0,style:A.input})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"username",children:"用户名"}),(0,r.jsx)("input",{type:"text",id:"username",value:s,onChange:e=>l(e.target.value),required:!0,style:A.input})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",children:"电子邮件"}),(0,r.jsx)("input",{type:"email",id:"email",value:c,onChange:e=>u(e.target.value),required:!0,style:A.input})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",children:"密码"}),(0,r.jsx)("input",{type:"password",id:"password",value:h,onChange:e=>g(e.target.value),required:!0,style:A.input})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"confirmPassword",children:"确认密码"}),(0,r.jsx)("input",{type:"password",id:"confirmPassword",value:m,onChange:e=>x(e.target.value),required:!0,style:A.input})]}),(0,r.jsx)("button",{type:"submit",style:A.button,children:"注册"})]})]})})};var g=a(3426);let m={src:"/_next/static/media/logo.de7d5e9a.png",height:459,width:544,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAMAAAACh/xsAAAAFVBMVEVCZlM+ZVRCZlRBZlRDZlRBZVJCZ1Q+iudNAAAAB3RSTlM7C01VeiVkMj0QewAAAAlwSFlzAAALEwAACxMBAJqcGAAAACxJREFUeJwdyrcNADAQw0DF339kQ2Z1BUGsErzBBKVEGpzDxyUfbtE9sGTwAQxhAG/rT8HQAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:7};var x=a(6648);let p={src:"/_next/static/media/createpost.fd9fe6a9.png",height:120,width:120,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAJFBMVEURl9wAk9oRl90Rmt8RltoSltoRltsNl9USldsRldsSltsUq/nHqbs7AAAAC3RSTlObAaFHv4dqJcHHk7hdskMAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAySURBVHicJcrJDQAgDAPB3YRT9N8vCvjjsWQWRHdsUI0YD3GwUN3BPDXAmSr/XGi8tAsWAgCD8v2P+AAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},b={src:"/_next/static/media/search.5b127859.png",height:120,width:120,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAG1BMVEUbGxsrKystLS0tLS0sLCwtLS0qKiosLCwsLCwzWUgmAAAACXRSTlMBtg4nnzY6RdCaJwB/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMUlEQVR4nCWLyQ0AMAzCDLm6/8RVWl4YGcBhNq3UbFETMkQCWWDFXxilTq3kdun9FrgQMABw6U36lgAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8};var w=a(7138),f=a(6463);a(1643);let v={src:"/_next/static/media/user.c64fa86c.png",height:120,width:120,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAWlBMVEUSnesPpvQYgbgVm+AeFBAcWnsUfLQFlN9MaXE1IxgcXoLp4thZrtn78Op+vuC91+K91+MToOr/4LxtobUUJC0zpN3p3MUGm+n96cqckID858iXi32b1PKe1fJX2UErAAAAEnRSTlMurrSv/vvs8AD5+/75/q7z86znyt2OAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAQklEQVR4nAXBBxKAIBAAsRWRo+tQrf//pgkW5TeFBdO0bgYW767HbQtSy3mXKkgfpYwurDOGEOcK8qX0CljyfmTsD122Ate7Iq/yAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8};function y(e){let{children:t}=e,[a,s]=(0,i.useState)(!1),[o,c]=(0,i.useState)(!1),[A,y]=(0,i.useState)(!1),[j,C]=(0,i.useState)({}),[S,k]=(0,i.useState)(!1),N=(0,f.usePathname)(),[E,R]=(0,i.useState)(""),U=e=>{C(e),y(!0),s(!1)};return(0,i.useEffect)(()=>{let e=(0,g.LP)();e&&(async()=>{try{let t=await (0,d.v_)("/users/get-user-info",{token:e},!0);200===t.status&&(console.log("用户信息:",t),C(t.user),y(!0),localStorage.setItem("userId",t.user._id),console.log(t.user._id))}catch(e){console.log("请求用户信息时发生错误:",e)}})()},[A]),(0,i.useEffect)(()=>{let e=()=>{k(window.scrollY>600)};return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}},[]),(0,r.jsx)("html",{lang:"en",children:(0,r.jsxs)("body",{className:"".concat(l().variable," ").concat(n().variable," antialiased"),children:[(0,r.jsx)("header",{className:"flex items-center justify-center w-full py-2 border-b border-gray-300",children:(0,r.jsxs)("div",{className:"flex items-center justify-between w-4/5 mx-auto",children:[(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)(w.default,{href:"/",children:(0,r.jsx)(x.default,{src:m,alt:"Logo",width:50,height:50,className:"rounded-full"})})}),(0,r.jsxs)("div",{className:"flex items-center flex-1 mx-5",children:[(0,r.jsx)("input",{type:"text",placeholder:"搜索...",className:"flex-1 px-3 py-2 border border-gray-300 rounded",value:E,onChange:e=>R(e.target.value)}),(0,r.jsx)("button",{onClick:()=>{E.trim()&&(window.location.href="/post/search/".concat(E))},children:(0,r.jsx)(x.default,{src:b,alt:"搜索",width:30,height:30,className:"ml-3 cursor-pointer"})})]}),(0,r.jsx)("div",{className:"flex",children:A?(0,r.jsxs)("div",{className:"relative inline-block group flex items-center",children:[(0,r.jsx)(w.default,{href:"/userprofile",className:"flex items-center",children:(0,r.jsx)(x.default,{src:j.img_path||v,alt:"".concat(j.username||"用户","的头像"),width:50,height:50,className:"cursor-pointer rounded-full object-cover"})}),(0,r.jsxs)("div",{className:"absolute hidden w-60 p-4 bg-white border border-gray-300 shadow-md mt-40 group-hover:block",style:{zIndex:1e4},children:[(0,r.jsxs)("p",{children:["用户名: ",j.name]}),(0,r.jsxs)("p",{children:["邮箱: ",j.email]}),(0,r.jsxs)("p",{children:["身份: ",j.role]})]}),(0,r.jsx)("button",{className:"px-4 py-2 ml-2 text-white bg-blue-600 rounded",onClick:()=>{y(!1),C({}),(0,g.gy)(),localStorage.removeItem("userId")},children:"登出"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"px-4 py-2 ml-2 text-white bg-blue-600 rounded",onClick:()=>s(!0),children:"登入"}),(0,r.jsx)("button",{className:"px-4 py-2 ml-2 text-white bg-blue-600 rounded",onClick:()=>c(!0),children:"注册"})]})})]})}),a&&(0,r.jsx)(u,{isOpen:a,onClose:()=>s(!1),onLoginSuccess:U}),o&&(0,r.jsx)(h,{onClose:()=>c(!1),onLoginSuccess:U}),A&&"/createpost"!==N&&(0,r.jsx)("div",{className:"fixed bottom-16 right-5 p-2 cursor-pointer",children:(0,r.jsx)(w.default,{href:"/createpost",children:(0,r.jsx)(x.default,{src:p,alt:"发帖",width:40,height:40})})}),t,S&&(0,r.jsx)("button",{onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},className:"fixed bottom-5 right-5 flex items-center justify-center w-12 h-12 bg-blue-600 text-white rounded-full transition-colors duration-300 hover:bg-blue-700",children:"↑"})]})})}a(8316)},3426:(e,t,a)=>{"use strict";function r(){return localStorage.getItem("token")}function s(){localStorage.removeItem("token")}function l(){return localStorage.getItem("userId")}a.d(t,{LP:()=>r,gy:()=>s,n5:()=>l})},3390:(e,t,a)=>{"use strict";a.d(t,{Ix:()=>i,U2:()=>o,v_:()=>n});var r=a(3426);let s="http://localhost:3001";async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(t.headers={"Content-Type":"application/json",...t.headers},a){let e=(0,r.LP)();e&&(t.headers.Authorization="Bearer ".concat(e))}try{let a=await fetch("".concat(s).concat(e),t);if(!a.ok)throw Error("请求错误！");return a.json()}catch(t){console.log("请求哪条api出错:","".concat(s).concat(e)),console.log("请求失败:",t)}}function o(e,t){return l(e,{method:"GET",needToken:t})}function n(e,t,a){return l(e,{method:"POST",body:JSON.stringify(t),needToken:a})}async function i(e){let t=new FormData;t.append("image",e);try{let e=await fetch("".concat(s,"/upload"),{method:"POST",body:t});if(!e.ok)throw Error("图片上传失败！");return await e.json()}catch(e){throw console.error("上传图片失败:",e),e}}},1643:()=>{},900:e=>{e.exports={style:{fontFamily:"'geistMono', 'geistMono Fallback'"},className:"__className_c3aa02",variable:"__variable_c3aa02"}},9965:e=>{e.exports={style:{fontFamily:"'geistSans', 'geistSans Fallback'"},className:"__className_1e4310",variable:"__variable_1e4310"}}},e=>{var t=t=>e(e.s=t);e.O(0,[569,967,289,881,138,974,130,215,744],()=>t(6766)),_N_E=e.O()}]);