(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2829:(e,t,s)=>{Promise.resolve().then(s.bind(s,1969))},7449:(e,t)=>{"use strict";function s(){return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s}}),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},451:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var a=s(7437),i=s(2265),o=s(3390);let l=e=>{let{postId:t,initialLikes:s,initialCollections:l,initialIsLiked:n,initialIsCollected:r,initialViews:c}=e,[d,u]=(0,i.useState)(s),[g,h]=(0,i.useState)(l),[f,m]=(0,i.useState)(n),[p,x]=(0,i.useState)(r),[y,b]=(0,i.useState)(c),[j,v]=(0,i.useState)(!1),[w,k]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{try{let e=await (0,o.U2)("/posts/".concat(t,"/actions"),{},!0);u(e.likes),h(e.collections),m(e.isLiked),x(e.isCollected),b(e.views)}catch(e){k("Error fetching post actions: "+e.message)}})()},[t]);let N=async()=>{if(!localStorage.getItem("token")){alert("Please login first");return}if(!j){v(!0),k(null),u(f?d-1:d+1),m(!f);try{let e=await (0,o.v_)("/posts/".concat(t,"/like"),{method:"POST"});if(200!==e.status)throw Error("Network response was not ok");let s=await e;u(s.likes),m(s.hasLiked)}catch(e){k("Error liking post: "+e.message),u(f?d+1:d-1),m(e=>!e)}finally{v(!1)}}},_=async()=>{if(!localStorage.getItem("token")){alert("Please login first");return}if(!j){v(!0),k(null),h(p?g-1:g+1),x(e=>!e);try{let e=await (0,o.v_)("/posts/".concat(t,"/collect"),{},!0);if(200!==e.status)throw Error("Network response was not ok");h(e.collections),x(e.isCollected)}catch(e){k("Error collecting post: "+e.message),h(p?g+1:g-1),x(!p)}finally{v(!1)}}};return(0,a.jsxs)("div",{className:"flex space-x-4 mt-2 bg-transparent",children:[w&&(0,a.jsx)("div",{className:"text-red-500",children:w}),(0,a.jsxs)("button",{onClick:N,disabled:j,"aria-label":f?"Unlike post":"Like post",className:"flex items-center space-x-1 px-4 py-2 rounded-lg transition duration-200 ease-in-out ".concat(f?"text-red-500 bg-gray-200 hover:bg-gray-300":"text-gray-500 bg-gray-200 hover:bg-gray-300"),children:[(0,a.jsx)("span",{children:f?"❤️":"\uD83E\uDD0D"}),(0,a.jsx)("span",{children:d})]}),(0,a.jsxs)("button",{onClick:_,disabled:j,"aria-label":p?"Uncollect post":"Collect post",className:"flex items-center space-x-1 px-4 py-2 rounded-lg transition duration-200 ease-in-out ".concat(p?"text-yellow-500 bg-gray-200 hover:bg-gray-300":"text-gray-500 bg-gray-200 hover:bg-gray-300"),children:[(0,a.jsx)("span",{children:p?"⭐":"☆"}),(0,a.jsx)("span",{children:g})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 px-4 py-2 rounded-lg transition duration-200 ease-in-out bg-gray-200 text-gray-800 hover:bg-gray-300",children:[(0,a.jsx)("span",{children:"\uD83D\uDC41️"}),(0,a.jsx)("span",{children:y})]})]})}},1969:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(7437),i=s(7449),o=s.n(i),l=s(7138),n=s(2265),r=s(3390),c=s(451);function d(){let[e,t]=(0,n.useState)([]),[s,i]=(0,n.useState)(12),[d,u]=(0,n.useState)(!1);(0,n.useEffect)(()=>{!async function(){t(await (0,r.U2)("/posts/"))}()},[]);let g=()=>{window.scrollY+window.innerHeight>=document.documentElement.scrollHeight-100&&!d&&h()},h=()=>{u(!0),setTimeout(()=>{i(e=>e+12),u(!1)},500)};return(0,n.useEffect)(()=>(window.addEventListener("scroll",g),()=>{window.removeEventListener("scroll",g)}),[d]),(0,a.jsxs)("div",{className:"flex flex-col items-center p-5 max-w-[1400px] mx-auto",children:[(0,a.jsxs)(o(),{children:[(0,a.jsx)("title",{children:"旅遊論壇"}),(0,a.jsx)("meta",{name:"description",content:"旅遊論壇主頁"})]}),(0,a.jsxs)("main",{className:"w-full",children:[(0,a.jsx)("h2",{className:"my-5 text-xl font-semibold",children:"最新帖子"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 w-full",children:[...e].sort((e,t)=>new Date(t.Creation_time)-new Date(e.Creation_time)).slice(0,s).map(e=>(0,a.jsxs)("div",{className:"relative group overflow-hidden",children:[(0,a.jsx)(l.default,{href:"/postsample/".concat(e._id),className:"block",children:(0,a.jsxs)("div",{className:"relative",children:[e.img_path&&(0,a.jsx)("img",{src:e.img_path,alt:e.title,className:"w-full h-[300px] object-cover transition-transform duration-300 group-hover:scale-105"}),(0,a.jsxs)("div",{className:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-center items-center text-center p-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-white mb-2",children:e.title.length>20?"".concat(e.title.substring(0,20),"..."):e.title}),(0,a.jsx)("p",{className:"text-gray-300 text-sm mb-4",children:new Date(e.Creation_time).toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})})]})]})},e._id),(0,a.jsx)("div",{className:"absolute inset-x-0 bottom-5 flex justify-center transition-opacity duration-300 opacity-0 group-hover:opacity-70",children:(0,a.jsx)(c.Z,{postId:e._id,initialLikes:e.likes,initialCollections:e.collections,initialIsLiked:e.isLiked,initialIsCollected:e.isCollected})})]},e._id))}),d&&(0,a.jsx)("div",{className:"flex justify-center my-5",children:(0,a.jsx)("p",{className:"text-lg text-gray-600",children:"加载中..."})})]})]})}},3426:(e,t,s)=>{"use strict";function a(){return localStorage.getItem("token")}function i(){localStorage.removeItem("token")}function o(){return localStorage.getItem("userId")}s.d(t,{LP:()=>a,gy:()=>i,n5:()=>o})},3390:(e,t,s)=>{"use strict";s.d(t,{Ix:()=>r,U2:()=>l,v_:()=>n});var a=s(3426);let i="http://localhost:3001";async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(t.headers={"Content-Type":"application/json",...t.headers},s){let e=(0,a.LP)();e&&(t.headers.Authorization="Bearer ".concat(e))}try{let s=await fetch("".concat(i).concat(e),t);if(!s.ok)throw Error("请求错误！");return s.json()}catch(t){console.log("请求哪条api出错:","".concat(i).concat(e)),console.log("请求失败:",t)}}function l(e,t){return o(e,{method:"GET",needToken:t})}function n(e,t,s){return o(e,{method:"POST",body:JSON.stringify(t),needToken:s})}async function r(e){let t=new FormData;t.append("image",e);try{let e=await fetch("".concat(i,"/upload"),{method:"POST",body:t});if(!e.ok)throw Error("图片上传失败！");return await e.json()}catch(e){throw console.error("上传图片失败:",e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[881,138,130,215,744],()=>t(2829)),_N_E=e.O()}]);