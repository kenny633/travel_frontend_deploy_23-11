(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[333],{7657:(e,t,s)=>{Promise.resolve().then(s.bind(s,5442))},9580:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var a=s(7437);s(2265),s(1532);let l=()=>(0,a.jsxs)("div",{className:"loading-container",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("p",{className:"loading-text",children:"加载中，请稍候..."})]})},451:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var a=s(7437),l=s(2265),r=s(3390);let i=e=>{let{postId:t,initialLikes:s,initialCollections:i,initialIsLiked:n,initialIsCollected:o,initialViews:c}=e,[d,h]=(0,l.useState)(s),[g,m]=(0,l.useState)(i),[u,x]=(0,l.useState)(n),[p,f]=(0,l.useState)(o),[y,j]=(0,l.useState)(c),[w,v]=(0,l.useState)(!1),[N,b]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,r.U2)("/posts/".concat(t,"/actions"),{},!0);h(e.likes),m(e.collections),x(e.isLiked),f(e.isCollected),j(e.views)}catch(e){b("Error fetching post actions: "+e.message)}})()},[t]);let k=async()=>{if(!localStorage.getItem("token")){alert("Please login first");return}if(!w){v(!0),b(null),h(u?d-1:d+1),x(!u);try{let e=await (0,r.v_)("/posts/".concat(t,"/like"),{method:"POST"});if(200!==e.status)throw Error("Network response was not ok");let s=await e;h(s.likes),x(s.hasLiked)}catch(e){b("Error liking post: "+e.message),h(u?d+1:d-1),x(e=>!e)}finally{v(!1)}}},S=async()=>{if(!localStorage.getItem("token")){alert("Please login first");return}if(!w){v(!0),b(null),m(p?g-1:g+1),f(e=>!e);try{let e=await (0,r.v_)("/posts/".concat(t,"/collect"),{},!0);if(200!==e.status)throw Error("Network response was not ok");m(e.collections),f(e.isCollected)}catch(e){b("Error collecting post: "+e.message),m(p?g+1:g-1),f(!p)}finally{v(!1)}}};return(0,a.jsxs)("div",{className:"flex space-x-4 mt-2 bg-transparent",children:[N&&(0,a.jsx)("div",{className:"text-red-500",children:N}),(0,a.jsxs)("button",{onClick:k,disabled:w,"aria-label":u?"Unlike post":"Like post",className:"flex items-center space-x-1 px-4 py-2 rounded-lg transition duration-200 ease-in-out ".concat(u?"text-red-500 bg-gray-200 hover:bg-gray-300":"text-gray-500 bg-gray-200 hover:bg-gray-300"),children:[(0,a.jsx)("span",{children:u?"❤️":"\uD83E\uDD0D"}),(0,a.jsx)("span",{children:d})]}),(0,a.jsxs)("button",{onClick:S,disabled:w,"aria-label":p?"Uncollect post":"Collect post",className:"flex items-center space-x-1 px-4 py-2 rounded-lg transition duration-200 ease-in-out ".concat(p?"text-yellow-500 bg-gray-200 hover:bg-gray-300":"text-gray-500 bg-gray-200 hover:bg-gray-300"),children:[(0,a.jsx)("span",{children:p?"⭐":"☆"}),(0,a.jsx)("span",{children:g})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 px-4 py-2 rounded-lg transition duration-200 ease-in-out bg-gray-200 text-gray-800 hover:bg-gray-300",children:[(0,a.jsx)("span",{children:"\uD83D\uDC41️"}),(0,a.jsx)("span",{children:y})]})]})}},5442:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(7437),l=s(6463),r=s(2265),i=s(3390),n=s(4200),o=s(6378),c=s(6176),d=s(9580),h=s(7138);s(7449);var g=s(451);let m=()=>{let{userId:e}=(0,l.useParams)(),[t,s]=(0,r.useState)({}),[m,u]=(0,r.useState)(""),[x,p]=(0,r.useState)([]),[f,y]=(0,r.useState)(12),[j,w]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{let t=await (0,i.v_)("/users/get-user",{userId:e},!1);if(t&&t.user){s(t.user);let e=(0,n.Q)((0,o.D)(t.user.Creation_time),{locale:c.c});u(e)}let a=await (0,i.U2)("/posts/".concat(e),!1);p(a)}catch(e){console.error("Failed to fetch user info:",e)}})()},[e]);let v=()=>{window.scrollY+window.innerHeight>=document.documentElement.scrollHeight-100&&!j&&N()},N=()=>{w(!0),setTimeout(()=>{y(e=>e+12),w(!1)},500)};return((0,r.useEffect)(()=>(window.addEventListener("scroll",v),()=>{window.removeEventListener("scroll",v)}),[j]),t.username)?(0,a.jsxs)("div",{className:"mx-auto bg-white shadow-md rounded-lg overflow-hidden mt-8 p-6 transition-transform duration-500 transform translate-y-0 opacity-0 animate-fadeIn",style:{maxWidth:"80%"},children:[(0,a.jsxs)("div",{className:"flex items-center space-x-6 mb-6",children:[(0,a.jsx)("img",{className:"w-32 h-32 rounded-full shadow-lg",src:t.img_path,alt:"".concat(t.name,"的头像")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-4xl font-bold",children:t.name}),(0,a.jsx)("p",{className:"text-xl font-light text-gray-500",children:t.role})]})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsxs)("p",{className:"text-lg text-gray-700",children:[(0,a.jsx)("strong",{children:"用户名:"})," ",t.username]}),(0,a.jsxs)("p",{className:"text-lg text-gray-700",children:[(0,a.jsx)("strong",{children:"电子邮件:"})," ",t.email]}),(0,a.jsxs)("p",{className:"text-lg text-gray-700",children:[(0,a.jsx)("strong",{children:"简介:"})," ",t.introduce]}),(0,a.jsxs)("p",{className:"text-lg text-gray-700",children:[(0,a.jsx)("strong",{children:"创建时间:"})," ",new Date(t.Creation_time).toLocaleString("zh-TW")]}),(0,a.jsxs)("p",{className:"text-lg text-gray-700",children:[(0,a.jsx)("strong",{children:"入站天数:"})," ",m]})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("h3",{className:"text-3xl font-semibold mb-4",children:"用户帖子"})}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 w-full",children:[...x].sort((e,t)=>new Date(t.Creation_time)-new Date(e.Creation_time)).slice(0,f).map(e=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.default,{href:"/postsample/".concat(e._id),children:(0,a.jsxs)("div",{className:"bg-gray-100 p-4 border border-gray-300 rounded shadow-lg hover:shadow-2xl animation-slideInUp",children:[e.img_path&&(0,a.jsx)("div",{className:"w-full h-[300px] overflow-hidden mb-2 rounded-lg",children:(0,a.jsx)("img",{src:e.img_path,alt:e.title,className:"w-full h-full object-cover transition-transform duration-300 hover:scale-105"})}),(0,a.jsx)("h3",{className:"text-lg font-medium overflow-hidden overflow-ellipsis whitespace-nowrap",children:e.title.length>20?"".concat(e.title.substring(0,20),"..."):e.title}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:new Date(e.Creation_time).toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})})]})},e._id),(0,a.jsx)("div",{className:"mt-2 w-full m-auto flex justify-center",children:(0,a.jsx)(g.Z,{postId:e._id,initialLikes:e.likes,initialCollections:e.collections,initialIsLiked:e.isLiked,initialIsCollected:e.isCollected})})]},e._id))}),j&&(0,a.jsx)("div",{className:"flex justify-center my-5",children:(0,a.jsx)("p",{className:"text-lg text-gray-600",children:"加载中..."})})]}):(0,a.jsx)(d.Z,{})}},3426:(e,t,s)=>{"use strict";function a(){return localStorage.getItem("token")}function l(){localStorage.removeItem("token")}function r(){return localStorage.getItem("userId")}s.d(t,{LP:()=>a,gy:()=>l,n5:()=>r})},3390:(e,t,s)=>{"use strict";s.d(t,{Ix:()=>o,U2:()=>i,v_:()=>n});var a=s(3426);let l="http://localhost:3001";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(t.headers={"Content-Type":"application/json",...t.headers},s){let e=(0,a.LP)();e&&(t.headers.Authorization="Bearer ".concat(e))}try{let s=await fetch("".concat(l).concat(e),t);if(!s.ok)throw Error("请求错误！");return s.json()}catch(t){console.log("请求哪条api出错:","".concat(l).concat(e)),console.log("请求失败:",t)}}function i(e,t){return r(e,{method:"GET",needToken:t})}function n(e,t,s){return r(e,{method:"POST",body:JSON.stringify(t),needToken:s})}async function o(e){let t=new FormData;t.append("image",e);try{let e=await fetch("".concat(l,"/upload"),{method:"POST",body:t});if(!e.ok)throw Error("图片上传失败！");return await e.json()}catch(e){throw console.error("上传图片失败:",e),e}}},1532:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[10,881,138,308,130,215,744],()=>t(7657)),_N_E=e.O()}]);