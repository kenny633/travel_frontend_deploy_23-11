(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[962],{9565:(e,t,l)=>{Promise.resolve().then(l.bind(l,6752))},7818:(e,t,l)=>{"use strict";l.d(t,{default:()=>r.a});var n=l(551),r=l.n(n)},6463:(e,t,l)=>{"use strict";var n=l(1169);l.o(n,"useParams")&&l.d(t,{useParams:function(){return n.useParams}}),l.o(n,"usePathname")&&l.d(t,{usePathname:function(){return n.usePathname}}),l.o(n,"useRouter")&&l.d(t,{useRouter:function(){return n.useRouter}})},551:(e,t,l)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let n=l(9920)._(l(148));function r(e,t){var l;let r={};"function"==typeof e&&(r.loader=e);let a={...r,...t};return(0,n.default)({...a,modules:null==(l=a.loadableGenerated)?void 0:l.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},912:(e,t,l)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let n=l(5592);function r(e){let{reason:t,children:l}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return l}},148:(e,t,l)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return u}});let n=l(7437),r=l(2265),a=l(912),o=l(5025);function s(e){return{default:e&&"default"in e?e.default:e}}let i={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},u=function(e){let t={...i,...e},l=(0,r.lazy)(()=>t.loader().then(s)),u=t.loading;function d(e){let s=u?(0,n.jsx)(u,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,d=i?r.Suspense:r.Fragment,c=t.ssr?(0,n.jsxs)(n.Fragment,{children:["undefined"==typeof window?(0,n.jsx)(o.PreloadChunks,{moduleIds:t.modules}):null,(0,n.jsx)(l,{...e})]}):(0,n.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(l,{...e})});return(0,n.jsx)(d,{...i?{fallback:s}:{},children:c})}return d.displayName="LoadableComponent",d}},5025:(e,t,l)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return s}});let n=l(7437),r=l(4887),a=l(8011),o=l(5759);function s(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let l=a.workAsyncStorage.getStore();if(void 0===l)return null;let s=[];if(l.reactLoadableManifest&&t){let e=l.reactLoadableManifest;for(let l of t){if(!e[l])continue;let t=e[l].files;s.push(...t)}}return 0===s.length?null:(0,n.jsx)(n.Fragment,{children:s.map(e=>{let t=l.assetPrefix+"/_next/"+(0,o.encodeURIPath)(e);return e.endsWith(".css")?(0,n.jsx)("link",{precedence:"dynamic",href:t,rel:"stylesheet",as:"style"},e):((0,r.preload)(t,{as:"script",fetchPriority:"low"}),null)})})}},6752:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>u});var n=l(7437),r=l(2265),a=l(6463),o=l(7818),s=l(3426),i=l(3390);(0,o.default)(Promise.all([l.e(363),l.e(516)]).then(l.t.bind(l,8436,23)),{loadableGenerated:{webpack:()=>[8436]},ssr:!1});let u=()=>{let e=(0,a.useRouter)(),[t,o]=(0,r.useState)(null),[u,d]=(0,r.useState)(""),[c,f]=(0,r.useState)(!1),[m,h]=(0,r.useState)(""),[g,p]=(0,r.useState)(!1),b=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=async()=>{if(b.current){let e=(await l.e(163).then(l.bind(l,1163))).default,t=(await l.e(697).then(l.t.bind(l,686,23))).default;e.register("modules/imageResize",t);let n=new e(b.current,{theme:"snow",modules:{toolbar:[[{font:[]}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,!1]}],[{align:[]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],[{color:[]},{background:[]}],["link","image"]],imageResize:{modules:["Resize","DisplaySize","Toolbar"]}}});n.on("text-change",()=>{h(n.root.innerHTML)}),n.getModule("toolbar").addHandler("image",()=>{let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.onchange=async e=>{let t=e.target.files[0];if(t){let e=n.getSelection();e&&(n.insertText(e.index,"上传中..",{color:"red"}),n.setSelection(e.index+5)),p(!0);try{let l=(await (0,i.Ix)(t)).imageUrl;n.deleteText(e.index,5),n.insertEmbed(e.index,"image",l),n.setSelection(e.index+1)}catch(t){alert("图片上传失败，请重试"),e&&(n.deleteText(e.index,5),n.insertText(e.index,"上传失败",{color:"red"}))}finally{p(!1)}}},e.click()}),b.current=n}};b.current&&e()},[]);let x=async e=>{let t=e.target.files[0];if(t){p(!0);try{let e=await (0,i.Ix)(t);o(e.imageUrl)}catch(e){alert("封面图片上传失败，请重试")}finally{p(!1)}}},y=async()=>{if(!u.trim()){alert("请输入标题");return}if(!m.trim()){alert("请输入内容");return}try{f(!0);let e=await (0,i.v_)("/posts/create-post",{title:u,content:m,img_path:t},!0);if(200!==e.status)throw Error(e.message||"发布失败");let l=e.postId;window.location.href="/postsample/".concat(l)}catch(e){alert("发布失败: ".concat(e.message))}finally{f(!1)}};return(0,r.useEffect)(()=>{(0,s.LP)()||(alert("请先登录"),e.push("/"))},[]),(0,n.jsxs)("div",{className:"flex flex-col items-center p-6 m-au bg-gray-100",style:{width:"100%"},children:[(0,n.jsxs)("div",{className:"w-full mb-6 bg-white p-4 rounded shadow",style:{maxWidth:"80%"},children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"上传封面图片"}),(0,n.jsxs)("div",{onClick:()=>document.getElementById("cover-image-input").click(),className:"relative border-dashed m-auto w-5/6 flex items-center justify-center rounded mb-4 cursor-pointer ".concat(g?"bg-gray-300":"bg-white"),style:{height:"500px"},children:[g?(0,n.jsx)("span",{className:"text-center",children:"上传中..."}):t?(0,n.jsx)("img",{src:t,alt:"Uploaded Cover",className:"object-contain w-full h-full",style:{width:"100%",borderRadius:"0.5rem"}}):(0,n.jsx)("span",{className:"text-gray-500",children:"点击上传图片"}),(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:x,id:"cover-image-input",className:"hidden"})]})]}),(0,n.jsxs)("div",{className:"w-full bg-white p-4 rounded shadow",style:{maxWidth:"80%"},children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"输入内容"}),(0,n.jsx)("input",{type:"text",value:u,onChange:e=>{d(e.target.value)},placeholder:"输入标题...",className:"w-full p-3 mb-4 border border-gray-300 rounded"}),(0,n.jsx)("div",{style:{maxHeight:"700px",overflow:"auto",minHeight:"200px"},children:(0,n.jsx)("div",{ref:b,className:"mt-2 max-h-screen",style:{height:"auto"}})}),g&&(0,n.jsx)("div",{className:"mt-2 text-orange-600",children:"图片加载中..."}),(0,n.jsx)("button",{onClick:y,disabled:c,className:"w-full py-2 mt-4 text-white rounded ".concat(c?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"),children:c?"发布中...":"发布帖子"})]})]})}},3426:(e,t,l)=>{"use strict";function n(){return localStorage.getItem("token")}function r(){localStorage.removeItem("token")}function a(){return localStorage.getItem("userId")}l.d(t,{LP:()=>n,gy:()=>r,n5:()=>a})},3390:(e,t,l)=>{"use strict";l.d(t,{Ix:()=>i,U2:()=>o,v_:()=>s});var n=l(3426);let r="http://localhost:3001";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(t.headers={"Content-Type":"application/json",...t.headers},l){let e=(0,n.LP)();e&&(t.headers.Authorization="Bearer ".concat(e))}try{let l=await fetch("".concat(r).concat(e),t);if(!l.ok)throw Error("请求错误！");return l.json()}catch(t){console.log("请求哪条api出错:","".concat(r).concat(e)),console.log("请求失败:",t)}}function o(e,t){return a(e,{method:"GET",needToken:t})}function s(e,t,l){return a(e,{method:"POST",body:JSON.stringify(t),needToken:l})}async function i(e){let t=new FormData;t.append("image",e);try{let e=await fetch("".concat(r,"/upload"),{method:"POST",body:t});if(!e.ok)throw Error("图片上传失败！");return await e.json()}catch(e){throw console.error("上传图片失败:",e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[130,215,744],()=>t(9565)),_N_E=e.O()}]);