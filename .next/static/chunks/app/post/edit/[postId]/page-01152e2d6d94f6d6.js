(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{8681:(e,t,n)=>{Promise.resolve().then(n.bind(n,6727))},7818:(e,t,n)=>{"use strict";n.d(t,{default:()=>r.a});var l=n(551),r=n.n(l)},6463:(e,t,n)=>{"use strict";var l=n(1169);n.o(l,"useParams")&&n.d(t,{useParams:function(){return l.useParams}}),n.o(l,"usePathname")&&n.d(t,{usePathname:function(){return l.usePathname}}),n.o(l,"useRouter")&&n.d(t,{useRouter:function(){return l.useRouter}})},551:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let l=n(9920)._(n(148));function r(e,t){var n;let r={};"function"==typeof e&&(r.loader=e);let a={...r,...t};return(0,l.default)({...a,modules:null==(n=a.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},912:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let l=n(5592);function r(e){let{reason:t,children:n}=e;if("undefined"==typeof window)throw new l.BailoutToCSRError(t);return n}},148:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return u}});let l=n(7437),r=n(2265),a=n(912),o=n(5025);function s(e){return{default:e&&"default"in e?e.default:e}}let i={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},u=function(e){let t={...i,...e},n=(0,r.lazy)(()=>t.loader().then(s)),u=t.loading;function c(e){let s=u?(0,l.jsx)(u,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,c=i?r.Suspense:r.Fragment,d=t.ssr?(0,l.jsxs)(l.Fragment,{children:["undefined"==typeof window?(0,l.jsx)(o.PreloadChunks,{moduleIds:t.modules}):null,(0,l.jsx)(n,{...e})]}):(0,l.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,l.jsx)(n,{...e})});return(0,l.jsx)(c,{...i?{fallback:s}:{},children:d})}return c.displayName="LoadableComponent",c}},5025:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return s}});let l=n(7437),r=n(4887),a=n(8011),o=n(5759);function s(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let n=a.workAsyncStorage.getStore();if(void 0===n)return null;let s=[];if(n.reactLoadableManifest&&t){let e=n.reactLoadableManifest;for(let n of t){if(!e[n])continue;let t=e[n].files;s.push(...t)}}return 0===s.length?null:(0,l.jsx)(l.Fragment,{children:s.map(e=>{let t=n.assetPrefix+"/_next/"+(0,o.encodeURIPath)(e);return e.endsWith(".css")?(0,l.jsx)("link",{precedence:"dynamic",href:t,rel:"stylesheet",as:"style"},e):((0,r.preload)(t,{as:"script",fetchPriority:"low"}),null)})})}},6727:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var l=n(7437),r=n(2265),a=n(6463),o=n(7818),s=n(3426),i=n(3390);(0,o.default)(Promise.all([n.e(363),n.e(516)]).then(n.t.bind(n,8436,23)),{loadableGenerated:{webpack:()=>[8436]},ssr:!1});let u=()=>{let e=(0,r.useRef)(null),{postId:t}=(0,a.useParams)(),o=(0,a.useRouter)(),[u,c]=(0,r.useState)(null),[d,f]=(0,r.useState)(""),[m,h]=(0,r.useState)(!1),[g,p]=(0,r.useState)(""),[y,b]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let t=async()=>{if(e.current){let t=(await n.e(163).then(n.bind(n,1163))).default,l=(await n.e(697).then(n.t.bind(n,686,23))).default;t.register("modules/imageResize",l);let r=new t(e.current,{theme:"snow",modules:{toolbar:[[{font:[]}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,!1]}],[{align:[]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],[{color:[]},{background:[]}],["link","image"]],imageResize:{modules:["Resize","DisplaySize","Toolbar"]}}});r.on("text-change",()=>{p(r.root.innerHTML)}),r.getModule("toolbar").addHandler("image",()=>{let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.onchange=async e=>{let t=e.target.files[0];if(t){let e=r.getSelection();e&&(r.insertText(e.index,"上传中..",{color:"red"}),r.setSelection(e.index+5)),b(!0);try{let n=(await (0,i.Ix)(t)).imageUrl;r.deleteText(e.index,5),r.insertEmbed(e.index,"image",n),r.setSelection(e.index+1)}catch(t){alert("内容图片上传失败，请重试"),e&&(r.deleteText(e.index,5),r.insertText(e.index,"上传失败",{color:"red"}))}finally{b(!1)}}},e.click()}),e.current=r}};e.current&&t()},[]),(0,r.useEffect)(()=>{(async()=>{try{(0,s.n5)();let n=await (0,i.U2)("/posts/".concat(t,"/edit"));console.log(n);let{post:l}=n;if(!1==n.permission){alert("您没有修改权限。"),o.push("/postsample/".concat(t));return}f(l.title),c(l.img_path),p(l.content),e.current&&(e.current.root.innerHTML=l.content)}catch(e){console.log("获取帖子数据失败，请重试")}})()},[]);let x=async e=>{let t=e.target.files[0];if(t){b(!0);try{let e=await (0,i.Ix)(t);c(e.imageUrl)}catch(e){alert("封面图片上传失败，请重试")}finally{b(!1)}}},w=async()=>{if(!d.trim()){alert("请输入标题");return}if(!g.trim()){alert("请输入内容");return}try{h(!0);let e=await (0,i.v_)("/posts/".concat(t,"/edit"),{title:d,content:g,img_path:u},!0);if(200!==e.status)throw Error(e.message||"编辑失败");o.push("/postsample/".concat(t))}catch(e){alert("编辑失败: ".concat(e.message))}finally{h(!1)}};return(0,r.useEffect)(()=>{(0,s.LP)()||(alert("请先登录"),o.push("/"))},[]),(0,l.jsxs)("div",{className:"flex flex-col items-center p-6 m-auto bg-gray-100",style:{width:"100%"},children:[(0,l.jsxs)("div",{className:"w-full mb-6 bg-white p-4 rounded shadow",style:{maxWidth:"60%"},children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"上传封面图片"}),(0,l.jsxs)("div",{onClick:()=>document.getElementById("cover-image-input").click(),className:"relative border-dashed m-auto w-5/6 flex items-center justify-center rounded mb-4 cursor-pointer ".concat(y?"bg-gray-300":"bg-white"),style:{height:"500px"},children:[y?(0,l.jsx)("span",{className:"text-center",children:"上传中..."}):u?(0,l.jsx)("img",{src:u,alt:"Uploaded Cover",className:"object-contain w-full h-full",style:{width:"100%",borderRadius:"0.5rem"}}):(0,l.jsx)("span",{className:"text-gray-500",children:"点击上传图片"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:x,id:"cover-image-input",className:"hidden"})]})]}),(0,l.jsxs)("div",{className:"w-full bg-white p-4 rounded shadow",style:{maxWidth:"60%"},children:[(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"输入内容"}),(0,l.jsx)("input",{type:"text",value:d,onChange:e=>f(e.target.value),placeholder:"输入标题...",className:"w-full p-3 mb-4 border border-gray-300 rounded"}),(0,l.jsx)("div",{style:{maxHeight:"700px",overflow:"auto",minHeight:"200px"},children:(0,l.jsx)("div",{ref:e,className:"mt-2 max-h-screen",style:{height:"auto"}})}),(0,l.jsx)("button",{onClick:w,disabled:m,className:"w-full py-2 mt-4 text-white rounded ".concat(m?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"),children:m?"发布中...":"更新帖子"})]})]})}},3426:(e,t,n)=>{"use strict";function l(){return localStorage.getItem("token")}function r(){localStorage.removeItem("token")}function a(){return localStorage.getItem("userId")}n.d(t,{LP:()=>l,gy:()=>r,n5:()=>a})},3390:(e,t,n)=>{"use strict";n.d(t,{Ix:()=>i,U2:()=>o,v_:()=>s});var l=n(3426);let r="http://localhost:3001";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(t.headers={"Content-Type":"application/json",...t.headers},n){let e=(0,l.LP)();e&&(t.headers.Authorization="Bearer ".concat(e))}try{let n=await fetch("".concat(r).concat(e),t);if(!n.ok)throw Error("请求错误！");return n.json()}catch(t){console.log("请求哪条api出错:","".concat(r).concat(e)),console.log("请求失败:",t)}}function o(e,t){return a(e,{method:"GET",needToken:t})}function s(e,t,n){return a(e,{method:"POST",body:JSON.stringify(t),needToken:n})}async function i(e){let t=new FormData;t.append("image",e);try{let e=await fetch("".concat(r,"/upload"),{method:"POST",body:t});if(!e.ok)throw Error("图片上传失败！");return await e.json()}catch(e){throw console.error("上传图片失败:",e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[130,215,744],()=>t(8681)),_N_E=e.O()}]);